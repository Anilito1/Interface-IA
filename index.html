<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>TP02 WebAR — Exercice 2+3 (caméra + détection + interaction)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="theme-color" content="#000000" />
  <!-- A-Frame 1.3.0 (stable avec AR.js) -->
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <!-- AR.js (build A-Frame) -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
  <style>
    /* Laisse voir la vidéo derrière */
    html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; background: transparent; }
    canvas.a-canvas { background: transparent !important; z-index: 1; position: relative; }

    /* La vidéo créée par AR.js : plein écran et derrière le canvas */
    #arjs-video {
      position: fixed; inset: 0;
      width: 100vw; height: 100vh; object-fit: cover;
      z-index: 0;
    }

    #hint, #status {
      position: fixed; left: 50%; transform: translateX(-50%);
      color: #fff; font: 14px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: rgba(0,0,0,.55); padding: 8px 12px; border-radius: 10px; z-index: 10; user-select: none;
    }
    #hint { bottom: 12px; }
    #status { top: 12px; }
  </style>
</head>
<body>
  <!-- Aides à l'écran -->
  <div id="status">En attente du marqueur Hiro…</div>
  <div id="hint">Autorise la caméra, puis vise le marqueur <b>Hiro</b> (bord noir entier dans le cadre).</div>

  <!-- Scène AR.js : alpha pour transparence du canvas, pas de videoTexture -->
  <a-scene
    embedded
    renderer="alpha: true; logarithmicDepthBuffer: true"
    arjs="sourceType: webcam; detectionMode: mono; debugUIEnabled: true;"
    vr-mode-ui="enabled: false"
  >
    <!-- Marqueur Hiro -->
    <a-marker id="hiroMarker" preset="hiro" emitevents="true">
      <!-- Boîte cliquable (Ex.3) -->
      <a-box id="rotBox" class="clickable"
             position="0 0.5 0"
             material="color: #4CC3D9; opacity: 0.65; shader: flat"
             animation="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear;">
      </a-box>
    </a-marker>

    <!-- Caméra AR + curseur pour clic/tap (Ex.3) -->
    <a-entity camera>
      <a-cursor raycaster="objects: .clickable" cursor="rayOrigin: mouse"></a-cursor>
    </a-entity>

    <!-- Marker personnalisé (pattern) : objet différent de la boîte -->
<a-marker type="pattern" url="pattern-CAMELEON.patt">
  <a-sphere position="0 0.5 0" radius="0.5" color="#9b59b6"
            animation="property: rotation; to: 360 0 0; loop: true; dur: 3000; easing: linear;">
  </a-sphere>
</a-marker>

  </a-scene>

  <script>
    // Ex.2 : Met à jour l'UI selon la détection
    document.addEventListener('DOMContentLoaded', () => {
      const hint = document.getElementById('hint');
      const status = document.getElementById('status');
      const marker = document.getElementById('hiroMarker');

      const onFound = () => {
        if (hint) hint.style.display = 'none';
        if (status) status.textContent = 'Marqueur détecté ✔';
      };
      const onLost = () => {
        if (hint) hint.style.display = 'block';
        if (status) status.textContent = 'Marqueur perdu… rapprochez/stabilisez le motif.';
      };

      marker.addEventListener('markerFound', onFound);
      marker.addEventListener('markerLost', onLost);
    });

    // Ex.3 : Interaction clic/tap sur la boîte -> couleur + vitesse
    document.addEventListener('DOMContentLoaded', () => {
      const box = document.getElementById('rotBox');
      const colors = ['#4CC3D9', '#EF2D5E', '#27ae60', '#2980b9'];
      let i = 0;
      let fast = false;

      box.addEventListener('click', () => {
        // 1) Change de couleur
        i = (i + 1) % colors.length;
        box.setAttribute('material', 'color', colors[i]);

        // 2) Alterne vitesse de rotation (4000ms -> 1000ms)
        fast = !fast;
        const dur = fast ? 1000 : 4000;
        box.setAttribute('animation',
          `property: rotation; to: 0 360 0; loop: true; dur: ${dur}; easing: linear;`
        );
      });
    });
  </script>
</body>
</html>
